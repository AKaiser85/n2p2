n2p2 - The neural network potential package
===========================================

@warning
This is a preliminary incomplete version of the full neural network potential
package. It contains only those parts of the code that are required to build the
LAMMPS interface, no training routines or other tools are included.  Only the
targets `doc`, `clean-doc`, `libnnp`, `libnnpif`, `clean-libnnp` and
`clean-libnnpif` (shared and static version) can be compiled. The documentation
is complete only with respect to the LAMMPS interface functionality (see
[LAMMPS interface build instructions](if_lammps.md) and [LAMMPS pair style
reference](pair_nnp.html)).

# Overview

Welcome to the neural network potential package! This repository provides
ready-to-use software for high-dimensional neural network potentials in
materials science. The methodology behind the Behler-Parinello neural network
potentials was first described here:

J. Behler and M. Parrinello, Phys. Rev. Lett. 98, 146401 (2007)
[https://doi.org/10.1103/PhysRevLett.98.146401]

This package contains software that will allow you to use existing neural
network potential parameterizations to predict energies and forces (with
standalone tools but also in conjunction with the MD software
[LAMMPS](http://lammps.sandia.gov/)). In addition it is possible to train new
neural network potentials with the provided training tools.

# First steps

In case you are a new user it might be a good idea to build the documentation
first. This requires [doxygen](http://www.stack.nl/~dimitri/doxygen/) and
[graphviz](https://www.graphviz.org/) to be installed on your system (tested
with doxygen version 1.8.14 and graphviz version 2.36.0). If the requirements
are met change to the `src` directory and try to build the documentation:
```
cd n2p2/src/
make doc
```
If the build process succeeds you can browse through the documentation starting
from the main page in:
```
n2p2/doc/html/index.html
```
If `graphviz` is not available on your system you can still build the
documentation if you set the option `HAVE_DOT` in the file `src/doc/Doxyfile` to
`NO`. However, then there will be no graphs generated by `doxygen`.

# Quick links

- [Atomic environment descriptors](descriptors.md)
- [Input file keywords](keywords.md)
- [Structure file format](cfg_file.md)
- [LAMMPS interface build instructions](if_lammps.md)
- [LAMMPS pair style reference](pair_nnp.html)

# Code structure

This package contains multiple components with varying interdependencies and
dependencies on third-party libraries. You may not need to build all
components, this depends on the intended use. The following table lists all
components and their respective requirements.

| Component                       | Location (relative to `<n2p2>`) | Requirements              | Function                                           |
| ------------------------------- | ------------------------------- | ------------------------- | -------------------------------------------------- |
| [libnnp](lib.md)                | `src`                           |                           | NNP core library (NN, SF, Structure, ...)          |
| [libnnpif](lib.md)              | `src`                           | `libnnp`, MPI             | Interfaces to other software (LAMMPS, ...)         |
| [pair_style  nnp](if_lammps.md) | `src/interface/LAMMPS`          | `libnnpif`                | %Pair style `nnp` for LAMMPS                       |
| [doc](doc.md)                   | `src/doc`                       | doxygen, graphviz         | Doxygen documentation                              |

@image html nnp-classes.png

# Purpose

As a new user of the NNP package you may find yourself in one of these three
possible scenarios:

## Prediction with existing neural network potential

If you have a working neural network potential setup (i.e. a settings file with
network and symmetry function parameters, weight files and a scaling file)
ready and want to predict energies and forces for a single structure you only
need these components:

- `libnnp`
- `nnp-predict`

## Molecular dynamics simulation

Similarly, if you have a working neural network potential setup and would like
to run an MD simulation with an external MD software (so far only LAMMPS is
supported), these components are required:

- `libnnp`
- `libnnpif`
- `pair_style nnp`

## Training a new neural network potential

To train a completely new neural network potential the following parts are required:

- `libnnp`
- `libnnptrain`
- `nnp-scaling`
- `nnp-train`

Additional, though not strictly required tools are also quite useful:

- `nnp-dataset`
- `nnp-prune`
- `nnp-symfunc`

# Build process

## The simple way using the master makefile

A master makefile is provided in the `<n2p2>/src` directory (where `<n2p2>`
denotes the NNP root directory) which provides targets for all individual
components. As a first step it is recommended to build the doxygen
documentation (requires doxygen and graphviz). Switch to the `src` directory
and type these commands:
```
cd <n2p2>/src/
make doc
firefox <n2p2>/doc/html/index.html
```
Now you can click on the links corresponding to the different components in the
above table to get more informations. Compiling other parts is also
straightforward, e.g. to compile the tool nnp-predict with dynamic linking:
```
cd <n2p2>/src/
make nnp-predict-shared
```
This will automatically build the required library `libnnp` and the tool
`nnp-predict`. Similarly, a static build is done like this:
```
make nnp-predict-static
```
To build everything (all libraries and tools) type:
```
make shared
```
or
```
make static
```
To clean up individual components or everything use for example one of these
```
make clean
make clean-doc
make clean-nnp-predict
```
Have a look at the main makefile in `<n2p2>/src/` for all available build
targets.

Currently the build process is designed for two different compilers, the GNU
compiler (`gnu`) and the Intel compiler (`intel`). It is possible to switch
between them via the `COMP` variable, e.g.
```
make libnnp COMP=intel
```
If you need to change compiler variables and paths have a look at the
corresponding makefiles containing global build parameters:
```
<n2p2>/src/makefile.gnu
<n2p2>/src/makefile.intel
```
You can also create new parameter makefiles based on the above and change the
file name suffix according to your target:
```
<n2p2>/src/makefile.target
make libnnp COMP=target
```
By default the makefile will use 4 processors for compiling multiple files at
once, this behaviour can be overriden with the CORES switch, e.g. to use 8
cores:
```
make libnnp CORES=-j8
```
_Note:_ Do not use the `-j` switch for the master makefile, this may mess up
the compilation order.

## Individual component makefiles

Sometimes it is necessary to change build settings for individual components,
e.g. you may need to set the path to the Eigen library to compile the tool
`nnp-train`. Each component subdirectory comes with a separate makefile which
can be altered in this case.

# Keywords

The setup of a neural network potential (network topology, symmetry function
parameters,...) is stored in a simple text file with keyword-argument pairs. A
list of keywords is provided [here](keywords.md).

# Configurations

A description of the simple configuration file format can be found
[here](cfg_file.md).
